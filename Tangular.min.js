var Tangular={};Tangular.helpers={},Tangular.settings={delimiters:["{{","}}"]},Tangular.register=function(e,r){return Tangular.helpers[e]=r,Tangular},Tangular.compile=function(e){e||(e="");for(var r=-1,n=[],t=-1,i=0,a=e.length,s=0;a>r++;){var u=e.substring(r,r+2);if(-1===t)if(u!==Tangular.settings.delimiters[0]);else{if(-1!==t){s++;continue}var l=e.substring(i,r);n.push(l?'unescape("'+escape(l)+'")':'""'),t=r+2}else if(u===Tangular.settings.delimiters[1]){if(s>0){s--;continue}n.push(e.substring(t,r).trim()),i=r+2,t=-1;continue}}n.push('unescape("'+escape(e.substring(i,a))+'")'),a=n.length;for(var g="$output+=",f='var $s=this,$output="",$t;',o=[],p=!1,c=0,d=0;a>d;d++)if(d%2!==0){var h=n[d],v=!1,r=h.lastIndexOf("|"),T=null,b=h.substring(0,3);"if "===b&&(h="if( "+h.substring(3)+"){",v=!0),"foreach "===h.substring(0,8)&&(T=h.split(" "),"var"===T[1]&&T.splice(1,1),o.push(T[1]),v=!0,p=!0,c++);var $=h.substring(0,5);if("endif"===$||"fi"===h?(h="}",v=!0):"else"===$?(h="} else {",v=!0):"else if"===h.substring(0,7)?(h="}else if( "+h.substring(8)+"){",v=!0):("end"===b||"endfor"===h.substring(0,6))&&(h=0===o.length?"}":"}})();",o.pop(),v=!0,c--,0===c&&(p=!1)),h=v?Tangular.append(h,o,p).trim():Tangular.helper(h,o,p),v){if(T){var m=Tangular.append(T[3],o,p);h="if ("+m+"===null||"+m+"===undefined)"+m+"=[];(function(){for(var i=0,length="+m+".length;i<length;i++){var "+T[1]+"="+m+"[i];var $index=i;"}f+=h}else f+=g+h+";"}else f+=g+n[d]+";";return function(e){return new Function("helpers",f+";return $output;").call(e,Tangular.helpers)}},Tangular.helper=function(e,r,n){var t,i=e.indexOf("|");if(-1===i)return t=Tangular.append(e.trim(),r,n).trim(),"helpers.encode.call($s,"+t+")";t=Tangular.append(e.substring(0,i).trim(),r,n).trim(),e=e.substring(i+1).trim().split("|");for(var a="",s=0,u=e.length;u>s;s++){var l,g=e[s].trim().replace("()","");if(i=g.indexOf("("),-1===i?(l=g,g=".call($s,$t)"):(l=g.substring(0,i),g=".call($s,$t,"+g.substring(i+1)),!Tangular.helpers[l])throw new Error('Helper: "'+l+'" not found.');g='$t=helpers["'+l+'"]'+g,a+=g+";"}return'"";$t='+t+";"+a+"$output+=$t"},Tangular.append=function(e,r){return void 0===r&&(r=[]),e.replace(/[\_\$a-zá-žÁ-ŽA-Z0-9\s]+/g,function(e,n,t){var i=t.substring(n-1,n),a=!1,s=e.trim();switch(('"'===i||"'"===i||"."===i)&&(a=!0),e.trim()){case"else":case"end":case"endfor":case"endif":case"fi":case"foreach":case"if":case"else if":return e;case"$index":if(!a)return e}if(""===s)return"";if(a)return e;a=!1;for(var u=0,l=r.length;l>u;u++){var g=r[u].length;if(s.substring(0,g)===r[u]){if(s.length!==g){var i=s.substring(g,g+1);if("."!==i&&"+"!==i)continue}a=!0;break}}if(a)return s;i=s.substring(0,1);var f=i.charCodeAt(0);return f>47&&58>f?s:"$s."+s})},Tangular.render=function(e,r){return(void 0===r||null===r)&&(r={}),"string"==typeof e&&(e=Tangular.compile(e)),e(r)},Tangular.register("encode",function(e){return(void 0===e||null===e)&&(e=""),e.toString().replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),Tangular.register("raw",function(e){return(void 0===e||null===e)&&(e=""),e}),"undefined"!=typeof exports&&(module.exports=Tangular);