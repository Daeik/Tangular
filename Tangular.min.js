var Tangular={};Tangular.helpers={},Tangular.version="v1.4.0",Tangular.cache={},Tangular.debug=!1,Tangular.settings={delimiters:["{{","}}"]},Tangular.register=function(name,fn){return Tangular.helpers[name]=fn,Tangular},Tangular.compile=function(str){str||(str="");for(var text,index=-1,builder=[],beg=-1,end=0,length=str.length,count=0,len=Tangular.settings.delimiters[0].length;length>index++;){var c=str.substring(index,index+len);if(-1===beg)if(c!==Tangular.settings.delimiters[0]);else{if(-1!==beg){count++;continue}text=str.substring(end,index),builder.push(text?'unescape("'+escape(text)+'")':'""'),beg=index+len}else if(c===Tangular.settings.delimiters[1]){if(count>0){count--;continue}builder.push(str.substring(beg,index).trim()),end=index+len,beg=-1;continue}}text=str.substring(end,length),builder.push(text?'unescape("'+escape(text)+'")':'""'),length=builder.length;for(var plus="$output+=",output='var $s=this,$output="",$t,$v;',skip=[],isEach=!1,eachCount=0,i=0;length>i;i++)if(i%2!==0){var cmd=builder[i],add=!1,index=cmd.lastIndexOf("|"),arr=null,cmd3=cmd.substring(0,3);"if "===cmd3&&(cmd="if( "+cmd.substring(3)+"){",add=!0),"foreach "===cmd.substring(0,8)&&(arr=cmd.split(" "),"var"===arr[1]&&arr.splice(1,1),skip.push(arr[1]),add=!0,isEach=!0,eachCount++);var cmd5=cmd.substring(0,5);if("endif"===cmd5||"fi"===cmd?(cmd="}",add=!0):"else"===cmd5?(cmd="} else {",add=!0):"else if"===cmd.substring(0,7)?(cmd="}else if( "+cmd.substring(8)+"){",add=!0):("end"===cmd3||"endfor"===cmd.substring(0,6))&&(cmd=skip.length?"}})()}":"}}",skip.pop(),add=!0,eachCount--,0===eachCount&&(isEach=!1)),cmd=add?Tangular.append(cmd,skip,isEach,"$s").trim():Tangular.helper(cmd,skip,isEach,"$s"),add){if(arr){var m=Tangular.append(arr[3],skip,isEach,"$s");cmd="if ("+m+"&&"+m+".length){(function(){for(var i=0,length="+m+".length;i<length;i++){var "+arr[1]+"="+m+"[i];var $index=i;"}output+=cmd}else output+=plus+cmd+";"}else output+=plus+builder[i]+";";return Tangular.debug&&(console.log("Tangular:"),console.log("function(helpers) {"+output+";return $output;}"),console.log(str.trim()),console.log("---------------------------"),console.log("")),function(model){return new Function("helpers",output+";return $output;").call(model,function(name){var fn=Tangular.helpers[name];return fn?fn:(console.warn('Tangular helper "'+name+'" not found.'),function(value){return void 0===value?"undefined":null===value?"null":value.toString()})})}},Tangular.helper=function(line,skip,isEach){var property,index=line.indexOf("|");if(-1===index)return property=Tangular.append(line.trim(),skip,isEach,"$s").trim(),'helpers("encode").call($s,'+property+")";property=Tangular.append(line.substring(0,index).trim(),skip,isEach).trim(),line=line.substring(index+1).trim().split("|");for(var output="",i=0,length=line.length;length>i;i++){var name,helper=line[i].trim().replace("()","");index=helper.indexOf("("),-1===index?(name=helper,helper=".call($s,$t)"):(name=helper.substring(0,index),helper=".call($s,$t,"+helper.substring(index+1)),helper='$t=helpers("'+name+'")'+helper,output+=helper+";"}return'"";$t='+property+";"+output+"$output+=$t"},Tangular.append=function(line,skipl,isEach,model){return void 0===skipl&&(skipl=[]),line.replace(/[\_\$a-zá-žÁ-ŽA-Z0-9\s\.]+/g,function(word,index,text){var c=text.substring(index-1,index),skip=!1,updated=word.trim();switch(('"'===c||"'"===c||"."===c)&&(skip=!0),word.trim()){case"else":case"end":case"endfor":case"endif":case"fi":case"foreach":case"if":case"else if":return word;case"$index":if(!skip)return word}if(""===updated)return"";if(skip)return word;skip=!1;for(var j=0,length=skipl.length;length>j;j++){var l=skipl[j].length;if(updated.substring(0,l)===skipl[j]){if(updated.length!==l){var c=updated.substring(l,l+1);if("."!==c&&"+"!==c)continue}skip=!0;break}}if(skip)return updated;c=updated.substring(0,1);var code=c.charCodeAt(0);return code>47&&58>code?updated:"Tangular.$wrap("+(model||"$s")+',"'+updated+'")'})},Tangular.$wrap=function(model,path,def){var arr=Tangular.cache[path];if(null===arr)return model[path];if(arr||(arr=path.split("."),Tangular.cache[path]=1===arr.length?null:arr),1===arr.length)return model[path];for(var tmp=model,i=0,length=arr.length;length>i;i++){var p=arr[i];if(tmp=tmp[p],!tmp)return i+1===length?tmp:def}return tmp},Tangular.render=function(template,model){return(void 0===model||null===model)&&(model={}),"string"==typeof template&&(template=Tangular.compile(template)),template(model)},Tangular.register("encode",function(value){return(void 0===value||null===value)&&(value=""),value.toString().replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),Tangular.register("raw",function(value){return(void 0===value||null===value)&&(value=""),value}),"undefined"!=typeof global?global.Tangular=Tangular:"undefined"!=typeof window&&(window.Tangular||(window.Tangular=Tangular)),"undefined"!=typeof exports&&(module.exports=Tangular);