var Tangular={};Tangular.helpers={},Tangular.settings={delimiters:["{{","}}"]},Tangular.register=function(e,r){return Tangular.helpers[e]=r,Tangular},Tangular.compile=function(e){e||(e="");for(var r=-1,n=[],t=-1,i=0,a=e.length,u=0,s=Tangular.settings.delimiters[0].length;a>r++;){var l=e.substring(r,r+s);if(-1===t)if(l!==Tangular.settings.delimiters[0]);else{if(-1!==t){u++;continue}var g=e.substring(i,r);n.push(g?'unescape("'+escape(g)+'")':'""'),t=r+s}else if(l===Tangular.settings.delimiters[1]){if(u>0){u--;continue}n.push(e.substring(t,r).trim()),i=r+s,t=-1;continue}}n.push('unescape("'+escape(e.substring(i,a))+'")'),a=n.length;for(var f="$output+=",o='var $s=this,$output="",$t;',c=[],p=!1,d=0,h=0;a>h;h++)if(h%2!==0){var v=n[h],T=!1,r=v.lastIndexOf("|"),b=null,$=v.substring(0,3);"if "===$&&(v="if( "+v.substring(3)+"){",T=!0),"foreach "===v.substring(0,8)&&(b=v.split(" "),"var"===b[1]&&b.splice(1,1),c.push(b[1]),T=!0,p=!0,d++);var m=v.substring(0,5);if("endif"===m||"fi"===v?(v="}",T=!0):"else"===m?(v="} else {",T=!0):"else if"===v.substring(0,7)?(v="}else if( "+v.substring(8)+"){",T=!0):("end"===$||"endfor"===v.substring(0,6))&&(v=0===c.length?"}":"}})();",c.pop(),T=!0,d--,0===d&&(p=!1)),v=T?Tangular.append(v,c,p).trim():Tangular.helper(v,c,p),T){if(b){var x=Tangular.append(b[3],c,p);v="if ("+x+"===null||"+x+"===undefined)"+x+"=[];(function(){for(var i=0,length="+x+".length;i<length;i++){var "+b[1]+"="+x+"[i];var $index=i;"}o+=v}else o+="try { "+v+"; "+f+v+" } catch(e) { "+v.split(",")[0]+',""); } ;'}else o+=f+n[h]+";";return function(e){return new Function("helpers",o+";return $output;").call(e,function(e){var r=Tangular.helpers[e];return r?r:(console.warn('Tangular helper "'+e+'" not found.'),function(e){return void 0===e?"undefined":null===e?"null":e.toString()})})}},Tangular.helper=function(e,r,n){var t,i=e.indexOf("|");if(-1===i)return t=Tangular.append(e.trim(),r,n).trim(),'helpers("encode").call($s,'+t+")";t=Tangular.append(e.substring(0,i).trim(),r,n).trim(),e=e.substring(i+1).trim().split("|");for(var a="",u=0,s=e.length;s>u;u++){var l,g=e[u].trim().replace("()","");i=g.indexOf("("),-1===i?(l=g,g=".call($s,$t)"):(l=g.substring(0,i),g=".call($s,$t,"+g.substring(i+1)),g='$t=helpers("'+l+'")'+g,a+=g+";"}return'"";$t='+t+";"+a+"$output+=$t"},Tangular.append=function(e,r){return void 0===r&&(r=[]),e.replace(/[\_\$a-zá-žÁ-ŽA-Z0-9\s]+/g,function(e,n,t){var i=t.substring(n-1,n),a=!1,u=e.trim();switch(('"'===i||"'"===i||"."===i)&&(a=!0),e.trim()){case"else":case"end":case"endfor":case"endif":case"fi":case"foreach":case"if":case"else if":return e;case"$index":if(!a)return e}if(""===u)return"";if(a)return e;a=!1;for(var s=0,l=r.length;l>s;s++){var g=r[s].length;if(u.substring(0,g)===r[s]){if(u.length!==g){var i=u.substring(g,g+1);if("."!==i&&"+"!==i)continue}a=!0;break}}if(a)return u;i=u.substring(0,1);var f=i.charCodeAt(0);return f>47&&58>f?u:"$s."+u})},Tangular.render=function(e,r){return(void 0===r||null===r)&&(r={}),"string"==typeof e&&(e=Tangular.compile(e)),e(r)},Tangular.register("encode",function(e){return(void 0===e||null===e)&&(e=""),e.toString().replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),Tangular.register("raw",function(e){return(void 0===e||null===e)&&(e=""),e}),"undefined"!=typeof exports&&(module.exports=Tangular);